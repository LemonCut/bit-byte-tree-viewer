/**
 * @fileoverview Firestore Security Rules for the family-tree application.
 *
 * Core Philosophy:
 * This ruleset enforces a flexible security model allowing public read access to Persons and Connections, while restricting Tree and Connection writes to authorized users.
 *
 * Data Structure:
 * - /trees/{treeId}: Stores individual tree data. (Future use)
 * - /connections/{connectionId}: Stores all connection data in a single collection.
 * - /persons/{personId}: Stores person data. (Future use)
 *
 * Key Security Decisions:
 * - Persons and Connections are publicly readable.
 * - Connection writes are restricted to signed-in users.
 *
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Controls access to the /connections collection. Allows public read access for all users, but restricts create, update, and delete operations to authenticated users. This is necessary for the main organization chart to be viewable by anyone.
     * @path /connections/{connectionId}
     * @allow (get, list) Any user, including anonymous ones, can read connection data to view the org charts.
     * @allow (create, update, delete) Only authenticated users (admins) can modify the connections.
     * @principle Public read, authenticated write.
     */
    match /connections/{connectionId} {
      allow get, list: if true;
      allow create, update, delete: if request.auth != null;
    }

    /**
     * @description Controls access to the /trees collection. This is not currently used but is reserved for future functionality where trees might have specific owners or properties.
     * @path /trees/{treeId}
     */
    match /trees/{treeId} {
      allow get, list: if true;
      allow create, update, delete: if request.auth != null;
    }

    /**
     * @description Controls access to the /persons collection. This is not currently used but is reserved for future functionality.
     * @path /persons/{personId}
     */
    match /persons/{personId} {
      allow get, list: if true;
      allow create, update, delete: if false; // No one can write to persons directly for now.
    }
  }
}
